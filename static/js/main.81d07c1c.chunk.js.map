{"version":3,"sources":["components/Socket.js","components/Map.js","components/Chat.js","components/App.js","index.js"],"names":["socket","io","path","DefaultIcon","L","icon","iconUrl","shadowUrl","iconShadow","iconSize","iconAnchor","shadowSize","Marker","prototype","options","Map","flights","useState","flightsInfo","setFlightsInfo","useEffect","on","data","update_flight","index","length","element","code","destination","position","positions","origin","Set","push","new_flights","filter","i","off","MapContainer","center","zoom","scrollWheelZoom","style","height","width","TileLayer","attribution","url","map","f","Fragment","Popup","Polyline","pathOptions","color","new_color","Chat","user","messages","setMessages","divRef","useRef","msg","current","addEventListener","event","target","currentTarget","scroll","top","scrollHeight","behavior","Container","className","ref","message","name","Date","date","App","setUser","setName","newMessage","setNewMessage","emit","the_flights","Math","floor","random","toString","fluid","Row","Col","Form","onSubmit","e","preventDefault","handleSubmit","Group","InputGroup","Control","as","required","value","onChange","resize","Append","Button","type","title","placeholder","variant","onClick","Table","striped","bordered","hover","responsive","airline","plane","seats","colspan","passengers","p","age","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.81d07c1c.chunk.js","sourcesContent":["import io from \"socket.io-client\";\n\nconst socket = io(\"wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl\", {\n  path: '/flights'});\n\nexport default socket","import React, {useState, useEffect} from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup, Polyline } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\nimport icon from 'leaflet/dist/images/marker-icon.png';\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\nimport socket from \"./Socket\";\n\n\nlet DefaultIcon = L.icon({\n    iconUrl: icon,\n    shadowUrl: iconShadow,\n    iconSize:     [12, 18], // size of the icon\n    iconAnchor:   [6, 18],\n    shadowSize:   [0, 0],\n});\n\nL.Marker.prototype.options.icon = DefaultIcon;\n\nconst Map = ({flights}) => {\n\n    // const [flights, setFlights] = useState([]);\n    const [flightsInfo, setFlightsInfo] = useState(flights);\n\n    useEffect(() => {\n        socket.on(\"POSITION\", data => {\n            setFlightsInfo(flights => {\n                let update_flight = null;\n                for (let index = 0; index < flights.length; index++) {\n                    let element = flights[index];\n                    if (element.code === data.code) {\n                        update_flight = element;\n                        if (element.destination === data.position){\n                            update_flight.positions=[element.origin];\n                        } else {\n                            update_flight.positions = [...new Set(element.positions)];\n                            update_flight.positions.push(data.position);\n                        }\n                    }\n                    \n                }\n                let new_flights = flights.filter((i) => i.code !== data.code);\n                return [...new_flights, update_flight];\n                \n            })\n        });\n        return ()=>{socket.off()};\n    }, []);\n\n\n    return (\n        <MapContainer center={[-35.0, -60]} zoom={4.5} scrollWheelZoom={false} style={{height: '60vh', width: '60wh'}} >\n        <TileLayer\n          attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        {flightsInfo ? (        \n            flightsInfo.map(f => {\n            return(\n                <React.Fragment>\n                <Marker position={f.positions[f.positions.length-1]} key={f.code}>\n                    <Popup>\n                        {f.code}\n                    </Popup>\n                </Marker>\n                <Polyline positions={f.positions} pathOptions={{color: \"black\"}}/>\n                </React.Fragment>\n                \n        )})):null}\n        {flightsInfo ? (\n            flightsInfo.map(f=>{\n                const new_color = f.color;\n                return (\n                <React.Fragment>\n                    <Polyline positions={[f.origin,f.destination]} pathOptions={{color: new_color}}/>\n                </React.Fragment>\n                )\n\n            })\n        ):null}\n      </MapContainer>\n    );\n  }\n  \n  export default Map;\n","import React, {useState, useEffect, useRef} from \"react\";\nimport socket from \"./Socket\";\nimport{ Container } from \"react-bootstrap\";\n\nconst Chat = ({user}) =>{\n\n    const [messages, setMessages] = useState([]);\n\n    const divRef = useRef(null) \n\n    useEffect(()=>{\n        socket.on(\"CHAT\", data =>{\n            setMessages(msg=>{\n                return [...msg, data]})\n        });\n        return () => {socket.off()};\n    }, []);\n\n    useEffect(() => {\n        if (divRef) {\n            divRef.current.addEventListener('DOMNodeInserted', event => {\n            const { currentTarget: target } = event;\n            target.scroll({ top: target.scrollHeight, behavior: 'smooth' });\n          });\n        }\n      }, [])\n\n    return(\n        <Container className=\"d-flex\">\n            <div className=\"overflow-auto\" style={{height:380, width: 600}} ref={divRef}>\n                    <div className=\"d-flex flex-column align-items-start justify-content-end px-3\">\n                        {messages.map((message) => {\n                            return (              \n                            <div\n                                className={`my-1 d-flex flex-column ${message.name=== user ? 'align-self-end align-items-end' : 'align-items-start'}`}\n                            >\n                                <div\n                                    className={`rounded px-2 py-1 ${message.name === user ? 'bg-primary text-white' : 'border'}`}>\n                                    {message.message}\n                                </div>\n                                <div className={`text-muted small ${message.name === user ? 'text-right' : ''}`}>\n                                    {message.name=== user ? 'You' : message.name} <br></br>\n                                    Fecha: {Date(message.date)}\n                                </div>\n                            </div>); \n                            })}\n                    </div>\n            </div>\n        </Container>\n    )\n\n};\n\nexport default Chat;\n","import React, { useState, useEffect } from \"react\";\nimport Map from \"./Map\";\nimport socket from \"./Socket\";\nimport Chat from \"./Chat\";\nimport{ Container, Row, Col, Table, Button, Form, InputGroup  } from \"react-bootstrap\";\n\n\nconst App = () => {\n\n  const [flightsInfo, setFlightsInfo] = useState([]);\n\n  const [user, setUser] = useState('');\n\n  const [name, setName] = useState('');\n\n  const [newMessage, setNewMessage] = useState('');\n\n  useEffect(() => {\n    socket.emit(\"FLIGHTS\");\n    return ()=>{socket.off()};\n  }, []);\n\n  useEffect(() => {\n      socket.on(\"FLIGHTS\", data => {\n          setFlightsInfo((the_flights) => {\n            let new_flights = [];\n            for (let index = 0; index < data.length; index++) {\n              let element = data[index];\n              element.positions =[element.origin];\n              element.color = \"#\"+ Math.floor(Math.random()*16777215).toString(16);\n              new_flights.push(element);\n            }\n            return new_flights\n          });\n      });\n      return ()=>{socket.off()};\n  }, []);\n\n  const login = (e) => {\n    setUser(name);\n    e.preventDefault();\n  }\n\n  const handleSubmit = (e) => {\n    socket.emit(\"CHAT\", {name: user, message: newMessage});\n    setNewMessage('');\n    e.preventDefault();\n  }\n\n  \n  return (\n    <Container fluid>\n      <Row>\n        <Col>\n          <h3> Mapa en vivo</h3>\n        </Col>\n        <Col>\n          <h3>Chat en vivo. Usuario en línea: {user || \"No hay usuario\"} </h3>\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          {flightsInfo.length !== 0 ? (<Map flights={flightsInfo}/>): null}\n        </Col>\n        <Col className=\"d-flex flex-column\">\n        <Chat user={user}/>\n        {user ? (\n          <Form onSubmit={(e)=>{handleSubmit(e)}}>\n            <Form.Group className=\"m-2\">\n              <InputGroup>\n                  <Form.Control\n                  as=\"textarea\"\n                  required\n                  value={newMessage}\n                  onChange={e => setNewMessage(e.target.value)}\n                  style={{ height: '75px', resize: 'none' }}\n                  />\n                  <InputGroup.Append>\n                      <Button type=\"submit\">Enviar</Button>\n                  </InputGroup.Append>\n              </InputGroup>\n            </Form.Group>\n          </Form>\n          ) : (\n          <Form onSubmit={login} title=\"Login\">\n            <Form.Group className=\"m-2\">\n              <InputGroup>\n                  <Form.Control\n                  as=\"textarea\"\n                  required\n                  value={name}\n                  onChange={ e => setName(e.target.value)}\n                  placeholder=\"Escriba su nombre para poder participar en el chat\"\n                  style={{ height: '75px', resize: 'none' }}\n                  />\n                  <InputGroup.Append>\n                      <Button type=\"submit\">Login</Button>\n                  </InputGroup.Append>\n              </InputGroup>\n            </Form.Group>\n          </Form>)}\n        </Col>\n      </Row>\n      <Row>\n        <Button variant=\"primary\" onClick={(e)=>{socket.emit(\"FLIGHTS\");}}>\n          Obtener Información de los vuelos\n        </Button>\n        {flightsInfo?(       \n          <Table striped bordered hover responsive>\n            <thead>\n              <tr>\n                <th>Vuelo</th>\n                <th>Aerolinea</th>\n                <th>Origen</th>\n                <th>Destino</th>\n                <th>Avión</th>\n                <th>Cantidad de Asientos</th>\n                <th>Pasajeros</th>\n              </tr>\n            </thead>\n            <tbody>\n            {flightsInfo.map(f=>{\n              return(\n                <tr>\n                  <td>{f.code}</td>\n                  <td>{f.airline}</td>\n                  <td>Latitud:{f.origin[0]}, Longitud:{f.origin[1]}</td>\n                  <td>Latitud:{f.destination[0]}, Longitud:{f.destination[1]}</td>\n                  <td>{f.plane}</td>\n                  <td>{f.seats}</td>\n                  <td colspan={f.passengers.length}>\n                    {f.passengers.map((p)=>{\n                      return(\n                        <td><tr>Nombre: {p.name}</tr><tr>Edad: {p.age}</tr></td>\n                      )\n                    })}\n                  </td>\n                </tr>\n              )\n            })}\n            </tbody>\n            </Table>):null}\n\n      </Row>\n    </Container>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}